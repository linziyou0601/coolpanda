{% extends "base.html" %}
{% block title %}牛批熊貓 - 推播訊息{% endblock %}
{% block navPush %}active{% endblock %}
{% block content %}

<div id="newPushMsg" class="modal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">推播訊息</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form method="post" class="col-12">
          <!-- 防止csrf攻擊 -->
          {% csrf_token %}
          <div class="form-group">
              <label for="{{ form.messageTitle.id_for_label }}">訊息標題</label>
              <input type="text" name="{{ form.messageTitle.html_name }}" class="form-control" id="{{ form.messageTitle.id_for_label }}" required>
          </div>
          <div class="form-group">
              <label for="{{ form.messageType.id_for_label }}">訊息類型</label>
              <select class="form-control" name="{{ form.messageType.html_name }}" id="{{ form.messageType.id_for_label }}">
              {% for x, y in form.messageType.field.choices %}
                <option value="{{ x }}"{% ifequal x 'text' %} selected{% endifequal %}>{{ y }}</option>
              {% endfor %}
              </select>
          </div>
          <div class="form-group">
              <label for="{{ form.messageContent.id_for_label }}">內容</label>
              <textarea rows="5" name="{{ form.messageContent.html_name }}" class="form-control" id="{{ form.messageContent.id_for_label }}" placeholder="文字訊息請直接輸入&#10;Flex訊息請輸入JSON格式文字&#10;圖片訊息請貼上'https://'網址" required></textarea>
          </div>

          <input type="submit" class="btn btn-info my-2 mx-2" value="發送" />
          <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
        </form>
      </div>
    </div>
  </div>
</div>


<div class="jumbotron">
  <div class="container">
    <h1 class="display-3 mt-3">推播訊息</h1>
    <h3 class="text-danger">{{ validStr }}</h3>
    <p><a class="btn btn-primary btn-lg" href="JavaScript:Void(0)" role="button" onclick="$('#newPushMsg').modal('show')">新增訊息 &raquo;</a></p>
  </div>
</div>

<div class="container">
  <h2>歷史推播訊息</h2>
  <table 
    data-toggle="table"
    data-url="jsonData/"
    data-pagination="true"
    data-search="true"
    data-sort-name="id"
    data-sort-order="desc"
    data-page-size="10"
    data-show-toggle="true"
    data-show-refresh="true">
    <thead>
      <tr>
        <th data-field="id" data-sortable="true">#</th>
        <th data-field="message_type" data-sortable="true">類型</th>
        <th data-field="message_title" data-sortable="true">標題</th>
        <th data-field="message_content" data-sortable="true">內容</th>
        <th data-field="create_at" data-sortable="true">建立時間</th>
      </tr>
    </thead>
  </table>
  <hr>
</div> <!-- /container -->
{% endblock %}